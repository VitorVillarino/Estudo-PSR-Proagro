---
title: "Estudo Proagro"
output: html_document
encoding: "UTF-8"
---

```{r setup, include=FALSE, echo=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = F)
source('./Scripts/LoadData.R', encoding = 'UTF-8')
library(pander)
library(ggplot2)
library(dplyr)
library(summarytools)
library(forcats)

# library(cluster)
# library(factoextra)
# library(fpc)
# library(NbClust)
# library(esquisse)
# library(forcats)

# library(lubridate)

st_options(plain.ascii = FALSE,        
            footnote = NA,           
            lang = "pt",
            subtitle.emphasis = FALSE   
 )
st_css()

```

## Top Culturas

```{r }
freq_cultura_psr <- left_join(
    x = as.data.frame(freq(fct_infreq(data_PSR$Produto_Padronizado)) %>% tb()),
    y = as.data.frame(freq(fct_infreq(data_PSR$Produto_Padronizado), weights = data_PSR$VL_LIMITE_GARANTIA ) %>% tb()),
    by = c("value" = "value")
)
pander(freq_cultura_psr)



freq_cultura_proagro <- left_join(
    x = as.data.frame(freq(fct_infreq(data_Proagro$Produto_Padronizado)) %>% tb()),
    y = as.data.frame(freq(fct_infreq(data_Proagro$Produto_Padronizado), weights = data_Proagro$VALOR_TOTAL) %>% tb()),
    by = c("value" = "value")
)
pander(freq_cultura_proagro)
     
```



#  Teste - Por municipio para Soja


```{r echo=FALSE}

PSR_soja_mun <- data_PSR %>% 
            filter(Produto_Padronizado == "SOJA") %>% 
            group_by(Cod_Municipio, Produto_Padronizado) %>% 
            summarise(
                  num_seguros = n(),
                  NR_AREA_TOTAL = sum(NR_AREA_TOTAL),
                  VL_LIMITE_GARANTIA = sum(VL_LIMITE_GARANTIA),
                  VL_PREMIO_LIQUIDO = sum(VL_PREMIO_LIQUIDO),
                  VL_SUBVENCAO_FEDERAL = sum(VL_SUBVENCAO_FEDERAL),
                  NR_PRODUTIVIDADE_ESTIMADA = sum(NR_PRODUTIVIDADE_ESTIMADA),
                  NR_PRODUTIVIDADE_SEGURADA = sum(NR_PRODUTIVIDADE_SEGURADA),
                  PE_NIVEL_COBERTURA = sum(PE_NIVEL_COBERTURA)
            )
PSR_soja_mun$Area_Media               = PSR_soja_mun$NR_AREA_TOTAL/PSR_soja_mun$num_seguros
PSR_soja_mun$Limite_Medio             = PSR_soja_mun$VL_LIMITE_GARANTIA/PSR_soja_mun$num_seguros
PSR_soja_mun$Premio_Liquido_Medio     = PSR_soja_mun$VL_PREMIO_LIQUIDO/PSR_soja_mun$num_seguros
PSR_soja_mun$Subvencao_Media          = PSR_soja_mun$VL_SUBVENCAO_FEDERAL/PSR_soja_mun$num_seguros
PSR_soja_mun$Produtividade_Media      = PSR_soja_mun$NR_PRODUTIVIDADE_ESTIMADA/PSR_soja_mun$num_seguros
PSR_soja_mun$Produtividade_Seg_Media  = PSR_soja_mun$NR_PRODUTIVIDADE_SEGURADA/PSR_soja_mun$num_seguros
PSR_soja_mun$Cobertura_Media          = PSR_soja_mun$PE_NIVEL_COBERTURA/PSR_soja_mun$num_seguros


#Histograma
ggplot(PSR_soja_mun) +
 aes(x = num_seguros) +
 geom_histogram(bins = 54L, fill = "#0c4c8a") +
 theme_minimal()

esquisse::esquisser()




Proagro_soja_mun <- data_PSR %>% 
            filter(Produto_Padronizado == "SOJA") %>% 
            group_by(Cod_Municipio, Produto_Padronizado) %>% 
            summarise(
                  num_seguros = n(),
                  NR_AREA_TOTAL = sum(NR_AREA_TOTAL),
                  VL_LIMITE_GARANTIA = sum(VL_LIMITE_GARANTIA),
                  VL_PREMIO_LIQUIDO = sum(VL_PREMIO_LIQUIDO),
                  VL_SUBVENCAO_FEDERAL = sum(VL_SUBVENCAO_FEDERAL),
                  NR_PRODUTIVIDADE_ESTIMADA = sum(NR_PRODUTIVIDADE_ESTIMADA),
                  NR_PRODUTIVIDADE_SEGURADA = sum(NR_PRODUTIVIDADE_SEGURADA),
                  PE_NIVEL_COBERTURA = sum(PE_NIVEL_COBERTURA)
            )
PSR_soja_mun$Area_Media               = PSR_soja_mun$NR_AREA_TOTAL/PSR_soja_mun$num_seguros
PSR_soja_mun$Limite_Medio             = PSR_soja_mun$VL_LIMITE_GARANTIA/PSR_soja_mun$num_seguros
PSR_soja_mun$Premio_Liquido_Medio     = PSR_soja_mun$VL_PREMIO_LIQUIDO/PSR_soja_mun$num_seguros
PSR_soja_mun$Subvencao_Media          = PSR_soja_mun$VL_SUBVENCAO_FEDERAL/PSR_soja_mun$num_seguros
PSR_soja_mun$Produtividade_Media      = PSR_soja_mun$NR_PRODUTIVIDADE_ESTIMADA/PSR_soja_mun$num_seguros
PSR_soja_mun$Produtividade_Seg_Media  = PSR_soja_mun$NR_PRODUTIVIDADE_SEGURADA/PSR_soja_mun$num_seguros
PSR_soja_mun$Cobertura_Media          = PSR_soja_mun$PE_NIVEL_COBERTURA/PSR_soja_mun$num_seguros






```

#  Milho